var path = require('path');
var union = require('lodash').union;
var last = require('lodash').last;

var getOuterDirectory = function getOuterDirectory(directories) {
  return directories.reduce(function (topDir, currentDir) {
    var currentFolders = currentDir.split(path.sep);
    var topMostFolders = topDir.split(path.sep);

    if (currentFolders.length === topMostFolders.length && last(currentFolders) !== last(topMostFolders)) {
      return currentFolders.slice(0, -1).join(path.sep);
    }

    return currentFolders.length < topMostFolders.length ? currentDir : topDir;
  });
};

module.exports = function getHeaderSearchPath(sourceDir, headers) {
  var directories = union(headers.map(path.dirname));

  return directories.length === 1 ? '"$(SRCROOT)' + path.sep + path.relative(sourceDir, directories[0]) + '"' : '"$(SRCROOT)' + path.sep + path.relative(sourceDir, getOuterDirectory(directories)) + '/**"';
};