
'use strict';

var glob = require('glob');
var path = require('path');

var GLOB_PATTERN = '**/*.sln';

var TEST_PROJECTS = /test|example|sample/i;

var WINDOWS_BASE = 'windows';

var GLOB_EXCLUDE_PATTERN = ['**/@(node_modules)/**'];

module.exports = function findSolution(folder) {
  var projects = glob.sync(GLOB_PATTERN, {
    cwd: folder,
    ignore: GLOB_EXCLUDE_PATTERN
  }).filter(function (project) {
    return path.dirname(project) === WINDOWS_BASE || !TEST_PROJECTS.test(project);
  }).sort(function (projectA, projectB) {
    return path.dirname(projectA) === WINDOWS_BASE ? -1 : 1;
  });

  if (projects.length === 0) {
    return null;
  }

  return projects[0];
};